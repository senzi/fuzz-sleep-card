<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‘›ç±³å¦®ç¡çœ åˆ†æå°å¡ç‰‡ Pro</title>
    <script src="https://unpkg.com/@zumer/snapdom/dist/snapdom.js"></script>
    
    <style>
        :root {
            --primary: #6c5ce7;
            --primary-light: #a29bfe;
            --bg: #dfe6e9;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-light: #b2bec3;
            --good: #00b894;
            --bad: #ff7675;
            --neutral: #636e72;
        }

        body {
            font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* --- å¡ç‰‡ä¸»ä½“ --- */
        .card {
            width: 400px;
            background: var(--card-bg);
            border-radius: 24px;
            /* è¿™é‡Œçš„ box-shadow åªåœ¨ç½‘é¡µå±•ç¤ºæ—¶æœ‰æ•ˆï¼Œsnapdom æˆªå›¾æ—¶å¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œä½†é€šå¸¸ä¸æˆªå–å¤–éƒ¨é˜´å½±æ›´å¹²å‡€ */
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-info h2 { margin: 0; font-size: 28px; }
        .header-info p { margin: 5px 0 0 0; opacity: 0.8; font-size: 13px; letter-spacing: 1px;}
        
        .header-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }

        .metrics-list {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .metric-row {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-radius: 16px;
            padding: 12px 15px;
        }
        
        .m-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            flex-shrink: 0;
        }

        .m-content { flex-grow: 1; }
        
        .m-top {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 4px;
        }

        .m-label { font-size: 12px; color: var(--text-light); font-weight: bold;}
        .m-value { font-size: 18px; font-weight: bold; color: var(--text-main); }

        .m-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .m-comment {
            font-size: 11px;
            color: var(--primary);
            opacity: 0.8;
            font-weight: 500;
        }

        .trend-pill {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .trend-good { background: rgba(0, 184, 148, 0.1); color: var(--good); }
        .trend-bad { background: rgba(255, 118, 117, 0.1); color: var(--bad); }
        .trend-flat { background: rgba(99, 110, 114, 0.1); color: var(--neutral); }

        .gemini-box {
            margin: 0 20px 25px 20px;
            background: #f1f2f6;
            border-radius: 16px;
            padding: 15px;
            position: relative;
            border-left: 4px solid var(--primary);
        }

        .gemini-title {
            font-size: 12px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .gemini-text {
            font-size: 13px;
            line-height: 1.6;
            color: #444;
            text-align: justify;
        }

        .footer {
            text-align: center;
            padding-bottom: 15px;
            font-size: 10px;
            color: #ccc;
        }

        /* --- æŒ‰é’®æ ·å¼ --- */
        .controls { margin-top: 20px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;}
        .btn {
            padding: 10px 24px; border: none; border-radius: 50px;
            cursor: pointer; font-weight: bold; font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-main { background: var(--primary); color: white; }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(108, 92, 231, 0.3); }
        .btn-sub { background: white; color: var(--text-main); }
        .btn-sub:hover { transform: translateY(-2px); }
        
        /* ä¸‹è½½æŒ‰é’®ç‰¹æ®Šé¢œè‰² */
        .btn-download { background: #2d3436; color: white; }
        .btn-download:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(45, 52, 54, 0.3); }

        .modal-wrap {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: all 0.3s;
            z-index: 999;
        }
        .modal-wrap.active { opacity: 1; visibility: visible; }
        .modal { background: white; width: 90%; max-width: 500px; padding: 25px; border-radius: 20px; }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-family: monospace; resize: vertical; margin: 15px 0; box-sizing: border-box;}
        textarea:focus { outline: 2px solid var(--primary); border-color: transparent; }
    </style>
</head>
<body>

    <div class="card" id="card">
        <div class="card-header">
            <div class="header-info">
                <h2 id="disp-day">Day 14</h2>
                <p id="disp-date">2025.12.26 / Friday</p>
            </div>
            <div class="header-badge">Fuzz Sleep</div>
        </div>

        <div class="metrics-list" id="metrics-container"></div>

        <div class="gemini-box">
            <div class="gemini-title">âœ¨ Gemini Insight</div>
            <div class="gemini-text" id="disp-comment">Waiting for data...</div>
        </div>

        <div class="footer">Generated by Gemini Analysis</div>
    </div>

    <div class="controls">
        <button class="btn btn-sub" onclick="copyTemplate()">ğŸ“‹ å¤åˆ¶ JSON æ¨¡æ¿</button>
        <button class="btn btn-main" onclick="openModal()">âœï¸ å¡«å…¥ä»Šæ—¥æ•°æ®</button>
        <button class="btn btn-download" onclick="downloadImage()">ğŸ“¸ ä¿å­˜ä¸ºå›¾ç‰‡</button>
    </div>

    <div class="modal-wrap" id="modal">
        <div class="modal">
            <h3 style="margin-top:0;">è¾“å…¥æ•°æ® JSON</h3>
            <textarea id="json-input" placeholder="è¯·ç²˜è´´ Gemini ç»™ä½ çš„ JSON ä»£ç ..."></textarea>
            <div style="text-align: right;">
                <button class="btn btn-sub" onclick="closeModal()" style="margin-right: 10px; box-shadow:none; border:1px solid #eee;">å–æ¶ˆ</button>
                <button class="btn btn-main" onclick="renderCard()">ç”Ÿæˆå¡ç‰‡</button>
            </div>
        </div>
    </div>

    <script>
        // å½“å‰æ•°æ®çŠ¶æ€ï¼Œç”¨äºç”Ÿæˆæ–‡ä»¶å
        let currentDayVal = "14";

        // é»˜è®¤å ä½æ•°æ®
        const defaultData = {
            "day": "00",
            "date": "YYYY.MM.DD",
            "metrics": [
                {
                    "icon": "ğŸ›Œ", "label": "ç¡çœ æ•ˆç‡", "value": "00.0%", 
                    "trend": "up", "status": "good", "diff": "0.0%", "comment": "æ•°æ®çŠ¶æ€ç®€è¯„"
                },
                {
                    "icon": "ğŸŒŠ", "label": "æ·±åº¦ç¡çœ ", "value": "00:00", 
                    "trend": "up", "status": "good", "diff": "+0h00m", "comment": "æ·±åº¦ç¡çœ é˜¶æ®µåˆ†æ"
                },
                {
                    "icon": "â¤ï¸", "label": "å¹³å‡å¿ƒç‡", "value": "00 bpm", 
                    "trend": "down", "status": "good", "diff": "-0.0", "comment": "é™æ¯å¿ƒç‡å¥åº·åº¦"
                },
                {
                    "icon": "âš¡", "label": "HRV", "value": "00 ms", 
                    "trend": "up", "status": "good", "diff": "+0 ms", "comment": "èº«ä½“æ¢å¤èƒ½åŠ›æŒ‡æ ‡"
                },
                {
                    "icon": "â³", "label": "æ€»ç¡çœ ", "value": "00:00", 
                    "trend": "flat", "status": "neutral", "diff": "0m", "comment": "æ—¶é•¿æ˜¯å¦è¾¾æ ‡"
                }
            ],
            "overall": "è¿™é‡Œæ˜¯æ¥è‡ª Gemini çš„æ·±åº¦åˆ†æç®€è¿°ã€‚å®ƒå°†æ ¹æ®ä¸Šè¿°æ•°æ®ä¸ºä½ æä¾›ä¸ªæ€§åŒ–çš„ç¡çœ å»ºè®®ã€å¿ƒç†çŠ¶æ€è§‚å¯Ÿä»¥åŠé’ˆå¯¹æ€§çš„å¥åº·æé†’ wã€‚"
        };

        function render(data) {
            currentDayVal = data.day; // æ›´æ–°å¤©æ•°ä¾›ä¸‹è½½ä½¿ç”¨
            document.getElementById('disp-day').innerText = `Day ${data.day}`;
            document.getElementById('disp-date').innerText = data.date;
            document.getElementById('disp-comment').innerText = data.overall;

            const container = document.getElementById('metrics-container');
            container.innerHTML = ''; 

            data.metrics.forEach(m => {
                let arrow = m.trend === 'up' ? 'â–²' : (m.trend === 'down' ? 'â–¼' : '-');
                let trendClass = m.status === 'good' ? 'trend-good' : (m.status === 'bad' ? 'trend-bad' : 'trend-flat');

                const html = `
                <div class="metric-row">
                    <div class="m-icon">${m.icon}</div>
                    <div class="m-content">
                        <div class="m-top">
                            <span class="m-label">${m.label}</span>
                            <div class="trend-pill ${trendClass}">${arrow} ${m.diff}</div>
                        </div>
                        <div class="m-bottom">
                            <span class="m-value">${m.value}</span>
                            <span class="m-comment">${m.comment}</span>
                        </div>
                    </div>
                </div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // è°ƒç”¨ snapdom è¿›è¡Œä¸‹è½½
        function downloadImage() {
            const cardElement = document.getElementById('card');
            
            // ä½¿ç”¨ snapdom API
            // scale: 2 ç¡®ä¿ retina å±å¹•ä¸‹æ¸…æ™°
            snapdom.download(cardElement, {
                filename: `Gemini_Sleep_Day_${currentDayVal}`,
                format: 'png',
                scale: 2 
            }).then(() => {
                console.log('Image saved!');
            }).catch(err => {
                console.error('Snapdom error:', err);
                alert('ä¿å­˜å›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–æ‰‹åŠ¨æˆªå›¾ >_<');
            });
        }

        render(defaultData);

        const modal = document.getElementById('modal');
        const input = document.getElementById('json-input');

        function openModal() {
            modal.classList.add('active');
            if(!input.value) input.value = JSON.stringify(defaultData, null, 4);
        }
        function closeModal() { modal.classList.remove('active'); }
        function renderCard() {
            try {
                const data = JSON.parse(input.value);
                render(data);
                closeModal();
            } catch (e) { alert('JSON æ ¼å¼æœ‰è¯¯: ' + e.message); }
        }
        function copyTemplate() {
            navigator.clipboard.writeText(JSON.stringify(defaultData, null, 4)).then(() => {
                alert('æ¨¡æ¿å·²å¤åˆ¶ï¼w');
            });
        }
        modal.addEventListener('click', (e) => {
            if(e.target === modal) closeModal();
        });
    </script>
</body>
</html>
